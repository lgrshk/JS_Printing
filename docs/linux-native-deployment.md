# –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Print Server –Ω–∞ Linux –±–µ–∑ Docker

–ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Print Server –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä—ñ –±–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Docker.

## –û–ø–∏—Å

–¶—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–ø–∏—Å—É—î –ø—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Print Server –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä—ñ. –¶–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Docker —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—é –¥–ª—è —Ç–∏—Ö, —Ö—Ç–æ –≤—ñ–¥–¥–∞—î –ø–µ—Ä–µ–≤–∞–≥—É –Ω–∞—Ç–∏–≤–Ω–æ–º—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é.

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- ‚úÖ –ü—Ä–∏–π–æ–º JSON –∑–∞–ø–∏—Ç—ñ–≤ –∑ Oracle APEX —á–µ—Ä–µ–∑ HTTPS
- ‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ ZPL-–∫–æ–º–∞–Ω–¥ –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∏ —á–µ—Ä–µ–∑ TCP/IP
- ‚úÖ –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞–º–∏ (Let'sEncrypt)
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ DuckDNS –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö DNS
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —á–µ—Ä–µ–∑ cron
- ‚úÖ –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ –Ω–∞ –ø–æ—à—É–∫ –ø—Ä–∏–Ω—Ç–µ—Ä—ñ–≤
- ‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π –¥—Ä—É–∫ —Ç–∞ –¥–æ—Å—Ç—É–ø –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –ø—Ä–∏–Ω—Ç–µ—Ä—ñ–≤

## –í–∏–º–æ–≥–∏

- Linux —Å–µ—Ä–≤–µ—Ä (Ubuntu 20.04+ –∞–±–æ Debian 11+)
- Python 3.11 –∞–±–æ –Ω–æ–≤—ñ—à–∞ –≤–µ—Ä—Å—ñ—è
- Root –∞–±–æ sudo –¥–æ—Å—Ç—É–ø
- –î–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
- DuckDNS –∞–∫–∞—É–Ω—Ç (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ DNS)
- Git (–¥–ª—è –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é)

---

## üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–∏

#### 1.1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

```bash
sudo apt update
sudo apt upgrade -y
```

#### 1.2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–∞–∫–µ—Ç—ñ–≤

```bash
sudo apt install -y \
    python3 \
    python3-pip \
    python3-venv \
    git \
    gcc \
    openssl \
    certbot \
    python3-certbot-dns-duckdns \
    nginx \
    curl
```

#### 1.3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Å—ñ—ó Python

```bash
python3 --version
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Python 3.11 –∞–±–æ –Ω–æ–≤—ñ—à–∞ –≤–µ—Ä—Å—ñ—è

–Ø–∫—â–æ –≤–µ—Ä—Å—ñ—è Python –∑–∞—Å—Ç–∞—Ä—ñ–ª–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –Ω–æ–≤—ñ—à—É –≤–µ—Ä—Å—ñ—é:

```bash
# –î–ª—è Ubuntu 22.04+
sudo apt install -y python3.11 python3.11-venv python3.11-dev

# –ê–±–æ –¥–ª—è Ubuntu 20.04
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3.11-dev
```

---

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –¥–æ–¥–∞—Ç–∫—É

#### 2.1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```bash
sudo useradd -r -s /bin/bash -m -d /opt/print-server printserver
```

#### 2.2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

```bash
sudo mkdir -p /opt/print-server/{app,config,certs,logs,static}
sudo chown -R printserver:printserver /opt/print-server
```

---

### –ö—Ä–æ–∫ 3: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É

#### 3.1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```bash
cd /opt/print-server
sudo -u printserver git clone <URL_–í–ê–®–û–ì–û_–†–ï–ü–û–ó–ò–¢–û–†–Ü–Æ> .
```

–ê–±–æ —è–∫—â–æ —É –≤–∞—Å –≤–∂–µ —î –ª–æ–∫–∞–ª—å–Ω–∞ –∫–æ–ø—ñ—è –ø—Ä–æ–µ–∫—Ç—É:

```bash
# –Ø–∫—â–æ –ø—Ä–æ–µ–∫—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ JS_Printing/docker-print-server/
sudo cp -r /—à–ª—è—Ö/–¥–æ/JS_Printing/docker-print-server/app/* /opt/print-server/app/
sudo cp -r /—à–ª—è—Ö/–¥–æ/JS_Printing/docker-print-server/config/* /opt/print-server/config/ 2>/dev/null || true
sudo chown -R printserver:printserver /opt/print-server
```

#### 3.2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Python

```bash
cd /opt/print-server
sudo -u printserver python3 -m venv venv
sudo -u printserver ./venv/bin/pip install --upgrade pip
```

#### 3.3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

**–í–∞–∂–ª–∏–≤–æ:** –í–∏–¥–∞–ª—ñ—Ç—å –ø–∞–∫–µ—Ç `docker` –∑ requirements.txt, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.

```bash
cd /opt/print-server
sudo -u printserver ./venv/bin/pip install \
    Flask==3.0.0 \
    Werkzeug==3.0.1 \
    python-dotenv==1.0.0 \
    flask-cors==4.0.0 \
    gunicorn==21.2.0 \
    cryptography==42.0.5
```

–ê–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π requirements.txt –±–µ–∑ docker:

```bash
cd /opt/print-server
cat > requirements-native.txt << EOF
Flask==3.0.0
Werkzeug==3.0.1
python-dotenv==1.0.0
flask-cors==4.0.0
gunicorn==21.2.0
cryptography==42.0.5
EOF

sudo -u printserver ./venv/bin/pip install -r requirements-native.txt
```

#### 3.4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—Ä–æ–µ–∫—Ç—É

–ü—ñ—Å–ª—è –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞:

```bash
cd /opt/print-server
ls -la

# –ú–∞—î –±—É—Ç–∏:
# - app/ (–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –∑ –∫–æ–¥–æ–º –¥–æ–¥–∞—Ç–∫—É)
# - config/ (–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó)
# - requirements.txt (–∞–±–æ requirements-native.txt)
```

–Ø–∫—â–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ñ–∞–π–ª–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –ø—ñ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `docker-print-server/`):

```bash
cd /opt/print-server
# –ü–µ—Ä–µ–º—ñ—Å—Ç—ñ—Ç—å —Ñ–∞–π–ª–∏ –∑ –ø—ñ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
sudo -u printserver mv docker-print-server/app/* app/ 2>/dev/null || true
sudo -u printserver mv docker-print-server/config/* config/ 2>/dev/null || true
sudo -u printserver mv docker-print-server/requirements.txt . 2>/dev/null || true
```

#### 3.5. –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ Docker

**–í–∞–∂–ª–∏–≤–æ:** –£ —Ñ–∞–π–ª—ñ `app/main.py` —î —ñ–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è `docker`, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ certbot. –î–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ü–µ–π —ñ–º–ø–æ—Ä—Ç –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ –∑–∞–º—ñ–Ω–∏—Ç–∏.

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo -u printserver nano /opt/print-server/app/main.py
```

–ó–Ω–∞–π–¥—ñ—Ç—å —Ä—è–¥–æ–∫:
```python
import docker
```

–Ü –∑–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –∞–±–æ –≤–∏–¥–∞–ª—ñ—Ç—å –π–æ–≥–æ:
```python
# import docker  # –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
```

–¢–∞–∫–æ–∂ –∑–Ω–∞–π–¥—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é `ssl_renew()` —Ç–∞ –∑–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Docker API. –ê–±–æ –∑–∞–º—ñ–Ω—ñ—Ç—å –π–æ–≥–æ –Ω–∞ –ø—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ certbot —á–µ—Ä–µ–∑ subprocess:

```python
# –ó–∞–º—ñ—Å—Ç—å docker_client.containers.get('docker-print-server-certbot')
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ:
subprocess.run(['certbot', 'certonly', ...], check=True)
```

–î–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è –≤ —Ä–æ–∑–¥—ñ–ª—ñ "–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º".

---

### –ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DuckDNS

#### 4.1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó DuckDNS

```bash
sudo mkdir -p /etc/letsencrypt
sudo nano /etc/letsencrypt/duckdns.ini
```

–í—Å—Ç–∞–≤—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–º—ñ—Å—Ç (–∑–∞–º—ñ–Ω—ñ—Ç—å `your-duckdns-api-token-here` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π —Ç–æ–∫–µ–Ω):

```ini
dns_duckdns_token = –≤–∞—à-token-—Ç—É—Ç
```

–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X)

#### 4.2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É

```bash
sudo chmod 600 /etc/letsencrypt/duckdns.ini
```

#### 4.3. –û—Ç—Ä–∏–º–∞–Ω–Ω—è DuckDNS API token

1. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—è –Ω–∞ [duckdns.org](https://www.duckdns.org/)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `myprinter.duckdns.org`)
3. –°–∫–æ–ø—ñ—é–π—Ç–µ API token –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤–∞—à–æ–≥–æ –¥–æ–º–µ–Ω—É
4. –í—Å—Ç–∞–≤—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `/etc/letsencrypt/duckdns.ini`

---

### –ö—Ä–æ–∫ 5: –û—Ç—Ä–∏–º–∞–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É

#### 5.1. –û—Ç—Ä–∏–º–∞–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É —á–µ—Ä–µ–∑ DNS challenge

```bash
sudo certbot certonly \
    --authenticator dns-duckdns \
    --dns-duckdns-credentials /etc/letsencrypt/duckdns.ini \
    -d –≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org \
    --email –≤–∞—à-email@example.com \
    --agree-tos \
    --non-interactive \
    --dns-duckdns-propagation-seconds 120
```

**–ó–∞–º—ñ–Ω—ñ—Ç—å:**
- `–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π –¥–æ–º–µ–Ω
- `–≤–∞—à-email@example.com` –Ω–∞ –≤–∞—à email

#### 5.2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É

```bash
sudo ls -la /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/
```

–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–±–∞—á–∏—Ç–∏ —Ñ–∞–π–ª–∏:
- `fullchain.pem` - –ø–æ–≤–Ω–∏–π –ª–∞–Ω—Ü—é–∂–æ–∫ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
- `privkey.pem` - –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á

#### 5.3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É

```bash
sudo chmod 644 /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/fullchain.pem
sudo chmod 600 /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/privkey.pem
sudo chown -R printserver:printserver /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/
```

---

### –ö—Ä–æ–∫ 6: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞—Ç–∫—É

#### 6.1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

```bash
sudo -u printserver nano /opt/print-server/config/config.json
```

–í—Å—Ç–∞–≤—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–º—ñ—Å—Ç:

```json
{
  "duckdns_token": "–≤–∞—à-token-—Ç—É—Ç",
  "duckdns_domain": "–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org",
  "certbot_email": "–≤–∞—à-email@example.com",
  "auto_renew_certs": true
}
```

–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X)

#### 6.2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

```bash
sudo -u printserver nano /opt/print-server/.env
```

–í—Å—Ç–∞–≤—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–º—ñ—Å—Ç:

```bash
CONFIG_PATH=/opt/print-server/config/config.json
FLASK_ENV=production
APP_PORT=443
SSL_CERT_PATH=/etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/fullchain.pem
SSL_KEY_PATH=/etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/privkey.pem
PYTHONUNBUFFERED=1
FLASK_APP=app.main:app
```

–ó–∞–º—ñ–Ω—ñ—Ç—å `–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π –¥–æ–º–µ–Ω.

---

### –ö—Ä–æ–∫ 7: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è systemd service

#### 7.1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É —Å–µ—Ä–≤—ñ—Å—É

```bash
sudo nano /etc/systemd/system/print-server.service
```

–í—Å—Ç–∞–≤—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–º—ñ—Å—Ç (–∑–∞–º—ñ–Ω—ñ—Ç—å `–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω):

```ini
[Unit]
Description=Print Server
After=network.target

[Service]
Type=notify
User=printserver
Group=printserver
WorkingDirectory=/opt/print-server
Environment="PATH=/opt/print-server/venv/bin:/usr/local/bin:/usr/bin:/bin"
EnvironmentFile=/opt/print-server/.env
ExecStart=/opt/print-server/venv/bin/gunicorn \
    --bind 0.0.0.0:443 \
    --workers 4 \
    --timeout 120 \
    --certfile /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/fullchain.pem \
    --keyfile /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/privkey.pem \
    app.main:app
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X)

#### 7.2. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è systemd —Ç–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É

```bash
sudo systemctl daemon-reload
sudo systemctl enable print-server.service
sudo systemctl start print-server.service
```

#### 7.3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É

```bash
sudo systemctl status print-server.service
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `active (running)`

#### 7.4. –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤

```bash
# –õ–æ–≥–∏ —Å–µ—Ä–≤—ñ—Å—É
sudo journalctl -u print-server.service -f

# –ê–±–æ –æ—Å—Ç–∞–Ω–Ω—ñ 100 —Ä—è–¥–∫—ñ–≤
sudo journalctl -u print-server.service -n 100
```

---

### –ö—Ä–æ–∫ 8: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤

#### 8.1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
sudo nano /opt/print-server/certbot-renew.sh
```

–í—Å—Ç–∞–≤—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–º—ñ—Å—Ç:

```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —á–µ—Ä–µ–∑ Certbot –∑ DNS challenge

set -e

# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑ —Ñ–∞–π–ª—É
CONFIG_FILE="/opt/print-server/config/config.json"
DUCKDNS_CREDENTIALS="/etc/letsencrypt/duckdns.ini"

if [ ! -f "$CONFIG_FILE" ]; then
    echo "–ü–æ–º–∏–ª–∫–∞: —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: $CONFIG_FILE"
    exit 1
fi

if [ ! -f "$DUCKDNS_CREDENTIALS" ]; then
    echo "–ü–æ–º–∏–ª–∫–∞: —Ñ–∞–π–ª credentials DuckDNS –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: $DUCKDNS_CREDENTIALS"
    exit 1
fi

# –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–ø—Ä–æ—Å—Ç–∏–π –ø–∞—Ä—Å–∏–Ω–≥ JSON)
DUCKDNS_DOMAIN=$(grep -o '"duckdns_domain": "[^"]*"' "$CONFIG_FILE" | cut -d'"' -f4)
CERTBOT_EMAIL=$(grep -o '"certbot_email": "[^"]*"' "$CONFIG_FILE" | cut -d'"' -f4)
AUTO_RENEW=$(grep -o '"auto_renew_certs": [^,}]*' "$CONFIG_FILE" | cut -d' ' -f2)

if [ -z "$DUCKDNS_DOMAIN" ] || [ -z "$CERTBOT_EMAIL" ]; then
    echo "–ü–æ–º–∏–ª–∫–∞: –Ω–µ –≤–∫–∞–∑–∞–Ω–æ duckdns_domain –∞–±–æ certbot_email –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó"
    exit 1
fi

if [ "$AUTO_RENEW" != "true" ]; then
    echo "–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –≤–∏–º–∫–Ω–µ–Ω–æ"
    exit 0
fi

echo "–û–Ω–æ–≤–ª–µ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –¥–ª—è –¥–æ–º–µ–Ω—É: $DUCKDNS_DOMAIN (DNS challenge)"

# –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —á–µ—Ä–µ–∑ certbot –∑ DNS challenge
certbot renew \
    --dns-duckdns \
    --dns-duckdns-credentials "$DUCKDNS_CREDENTIALS" \
    --quiet \
    --no-self-upgrade

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤—ñ—Å –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
if [ $? -eq 0 ]; then
    echo "–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É print-server..."
    systemctl restart print-server.service
fi

echo "–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
```

–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X)

#### 8.2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

```bash
sudo chmod +x /opt/print-server/certbot-renew.sh
sudo chown printserver:printserver /opt/print-server/certbot-renew.sh
```

#### 8.3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
sudo crontab -e
```

–î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 12 –≥–æ–¥–∏–Ω):

```cron
0 */12 * * * /opt/print-server/certbot-renew.sh >> /opt/print-server/logs/certbot-renew.log 2>&1
```

–ê–±–æ –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ 3:00 —Ä–∞–Ω–∫—É:

```cron
0 3 * * * /opt/print-server/certbot-renew.sh >> /opt/print-server/logs/certbot-renew.log 2>&1
```

---

### –ö—Ä–æ–∫ 9: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ–∞–π—Ä–≤–æ–ª—É

#### 9.1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É UFW

```bash
sudo ufw status
```

#### 9.2. –î–æ–∑–≤—ñ–ª –ø–æ—Ä—Ç—É 443 (HTTPS)

```bash
sudo ufw allow 443/tcp
sudo ufw allow 80/tcp  # –î–ª—è Let's Encrypt challenge (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
sudo ufw reload
```

#### 9.3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª

```bash
sudo ufw status verbose
```

---

### –ö—Ä–æ–∫ 10: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### 10.1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä

```
https://–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org
```

#### 10.2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é

- –í–≤–µ–¥—ñ—Ç—å –≤–∞—à DuckDNS API Token
- –í–≤–µ–¥—ñ—Ç—å –≤–∞—à DuckDNS Domain
- –í–≤–µ–¥—ñ—Ç—å Email –¥–ª—è Certbot
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É —Å–µ—Ä–≤—ñ—Å—É

```bash
sudo systemctl status print-server.service
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
sudo journalctl -u print-server.service -n 50
```

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

- –í—ñ–¥–∫—Ä–∏–π—Ç–µ `https://–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É

### 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API

```bash
curl -k https://–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/api/health
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "status": "ok",
  "service": "docker-print-server"
}
```

---

## üîß –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–æ–º

### –ó–∞–ø—É—Å–∫

```bash
sudo systemctl start print-server.service
```

### –ó—É–ø–∏–Ω–∫–∞

```bash
sudo systemctl stop print-server.service
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
sudo systemctl restart print-server.service
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤

```bash
# –í —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
sudo journalctl -u print-server.service -f

# –û—Å—Ç–∞–Ω–Ω—ñ 100 —Ä—è–¥–∫—ñ–≤
sudo journalctl -u print-server.service -n 100

# –ó –ø–µ–≤–Ω–æ–≥–æ —á–∞—Å—É
sudo journalctl -u print-server.service --since "1 hour ago"
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É

```bash
sudo systemctl status print-server.service
```

---

## üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –≤—Ä—É—á–Ω—É

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ certbot

```bash
sudo certbot renew \
    --dns-duckdns \
    --dns-duckdns-credentials /etc/letsencrypt/duckdns.ini \
    --quiet \
    --no-self-upgrade
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
sudo systemctl restart print-server.service
```

### –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É

```bash
sudo /opt/print-server/certbot-renew.sh
```

---

## üìù –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ Oracle APEX

–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ Oracle APEX —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ –¥–æ Docker –≤–µ—Ä—Å—ñ—ó. –î–∏–≤—ñ—Ç—å—Å—è —Ä–æ–∑–¥—ñ–ª "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ Oracle APEX" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É README.md.

–û—Å–Ω–æ–≤–Ω—ñ –º–æ–º–µ–Ω—Ç–∏:

1. **–°—Ç–≤–æ—Ä—ñ—Ç—å Application Items –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 0:**
   - `P0_PRINT_SERVER_URL` - –ü–æ–≤–Ω–∏–π URL —Å–µ—Ä–≤–µ—Ä–∞ –¥—Ä—É–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `https://–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/api/print`)
   - `P0_PRINT_JS_ZPL` - JSON —Ä—è–¥–æ–∫ –∑ –¥–∞–Ω–∏–º–∏ –¥–ª—è –¥—Ä—É–∫—É

2. **–î–æ–¥–∞–π—Ç–µ JavaScript —Ñ–∞–π–ª –≤ Application:**
   - Shared Components ‚Üí User Interface ‚Üí JavaScript
   - File URLs: `#WORKSPACE_FILES#JS/apex-print-service#MIN#.js`

3. **–°—Ç–≤–æ—Ä—ñ—Ç—å Dynamic Action –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 0**

–î–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è –≤ `README.md` —Ç–∞ `examples/apex-usage-example.md`.

---

## üõ†Ô∏è –†–æ–∑–≤'—è–∑–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ø—Ä–∏–Ω—Ç–µ—Ä–∞

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –ø—Ä–∏–Ω—Ç–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –º–µ—Ä–µ–∂—ñ
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ IP –∞–¥—Ä–µ—Å—É —Ç–∞ –ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–∞
3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –ø–æ—Ä—Ç 9100 –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π —Ñ–∞–π—Ä–≤–æ–ª–æ–º
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u print-server.service -n 50`

### –ü–æ–º–∏–ª–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –¥–æ–º–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –≤ DuckDNS
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ DuckDNS API token –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤ `/etc/letsencrypt/duckdns.ini`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤:
   ```bash
   sudo ls -la /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/
   ```
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ certbot: `sudo tail -f /var/log/letsencrypt/letsencrypt.log`

### –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑ Oracle APEX

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è HTTPS (–Ω–µ HTTP)
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL —Å–µ—Ä–≤–µ—Ä–∞ –≤ JavaScript –∫–æ–¥—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ CORS –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ `app/main.py`
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤—ñ—Å—É: `sudo journalctl -u print-server.service -n 50`

### –°–µ—Ä–≤—ñ—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å: `sudo systemctl status print-server.service`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u print-server.service -n 100`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—ñ–≤:
   ```bash
   sudo ls -la /opt/print-server/
   sudo ls -la /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/
   ```
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Python –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–µ:
   ```bash
   sudo -u printserver /opt/print-server/venv/bin/python --version
   ```

### –ü–æ–º–∏–ª–∫–∞ –∑ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É:

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∞–≤–∞
sudo chown -R printserver:printserver /opt/print-server
sudo chmod 644 /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/fullchain.pem
sudo chmod 600 /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/privkey.pem
sudo chown printserver:printserver /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/privkey.pem
```

### –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó ssl_renew –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `/api/ssl-renew` —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `ssl_renew()` –≤ `app/main.py`.

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo -u printserver nano /opt/print-server/app/main.py
```

–ó–Ω–∞–π–¥—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é `ssl_renew()` —Ç–∞ –∑–∞–º—ñ–Ω—ñ—Ç—å –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Docker API, –Ω–∞ –ø—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ certbot:

```python
@app.route('/api/ssl-renew', methods=['POST'])
def ssl_renew():
    """–ü–µ—Ä–µ–≤–∏–ø—É—Å–∫ SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É"""
    try:
        # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
        config = load_config()
        domain = config.get('duckdns_domain', '')
        email = config.get('certbot_email', '')
        token = config.get('duckdns_token', '')
        
        if not domain:
            return jsonify({
                "status": "error",
                "message": "–î–æ–º–µ–Ω–Ω–µ —ñ–º'—è –Ω–µ –≤–∫–∞–∑–∞–Ω–æ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó"
            }), 400
        
        if not email:
            return jsonify({
                "status": "error",
                "message": "Email –∞–¥—Ä–µ—Å–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó"
            }), 400
        
        logger.info(f"–ü–æ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–≤–∏–ø—É—Å–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –¥–ª—è –¥–æ–º–µ–Ω—É: {domain}")
        
        # –í–∏–∫–æ–Ω—É—î–º–æ –∫–æ–º–∞–Ω–¥—É certbot –Ω–∞–ø—Ä—è–º—É
        certbot_cmd = [
            'certbot', 'certonly',
            '--authenticator', 'dns-duckdns',
            '--dns-duckdns-credentials', '/etc/letsencrypt/duckdns.ini',
            '-d', domain,
            '--email', email,
            '--agree-tos',
            '--non-interactive',
            '--force-renewal',
            '--dns-duckdns-propagation-seconds', '120'
        ]
        
        result = subprocess.run(
            certbot_cmd,
            capture_output=True,
            text=True,
            check=False
        )
        
        if result.returncode == 0:
            logger.info(f"–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É—Å–ø—ñ—à–Ω–æ –ø–µ—Ä–µ–≤–∏–ø—É—â–µ–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω—É: {domain}")
            
            # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤—ñ—Å –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
            try:
                subprocess.run(['systemctl', 'restart', 'print-server.service'], check=True)
                logger.info("–°–µ—Ä–≤—ñ—Å print-server –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ")
            except Exception as restart_error:
                logger.warning(f"–ù–µ –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å: {str(restart_error)}")
            
            return jsonify({
                "status": "success",
                "message": f"–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É—Å–ø—ñ—à–Ω–æ –ø–µ—Ä–µ–≤–∏–ø—É—â–µ–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω—É {domain}",
                "output": result.stdout
            }), 200
        else:
            error_msg = result.stderr or result.stdout or "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"
            logger.error(f"–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤–∏–ø—É—Å–∫—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É: {error_msg}")
            return jsonify({
                "status": "error",
                "message": f"–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤–∏–ø—É—Å–∫—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É: {error_msg}",
                "output": result.stdout,
                "error": result.stderr
            }), 500
            
    except subprocess.CalledProcessError as e:
        logger.error(f"–ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ certbot: {str(e)}", exc_info=True)
        return jsonify({
            "status": "error",
            "message": f"–ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏: {str(e)}"
        }), 500
    except Exception as e:
        logger.error(f"–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤–∏–ø—É—Å–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É: {str(e)}", exc_info=True)
        return jsonify({
            "status": "error",
            "message": f"Internal server error: {str(e)}"
        }), 500
```

**–í–∞–∂–ª–∏–≤–æ:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á `printserver` –º–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ `certbot` —Ç–∞ `systemctl`. –ú–æ–∂–ª–∏–≤–æ, –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è —Ü–∏—Ö –∫–æ–º–∞–Ω–¥ –∞–±–æ –¥–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –≥—Ä—É–ø.

---

## üîí –ë–µ–∑–ø–µ–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

- ‚úÖ –°–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ HTTPS
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è
- ‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–µ–∑ root –ø—Ä–∞–≤
- ‚úÖ –§–∞–π—Ä–≤–æ–ª –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –¥–æ–∑–≤–æ–ª—É —Ç—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏:**
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è fail2ban** (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):
   ```bash
   sudo apt install -y fail2ban
   sudo systemctl enable fail2ban
   sudo systemctl start fail2ban
   ```

3. **–†–µ–≥—É–ª—è—Ä–Ω—ñ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:**
   ```bash
   sudo tar -czf /backup/print-server-config-$(date +%Y%m%d).tar.gz \
       /opt/print-server/config/ \
       /etc/letsencrypt/duckdns.ini
   ```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

–ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ —Ç–∞–∫–æ—é:

```
/opt/print-server/
‚îú‚îÄ‚îÄ app/                    # –ö–æ–¥ –¥–æ–¥–∞—Ç–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ printer.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ scan_data.py
‚îÇ   ‚îî‚îÄ‚îÄ static/             # –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ config.json
‚îÇ   ‚îî‚îÄ‚îÄ scan_data.json
‚îú‚îÄ‚îÄ certs/                 # SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ (—Å–∏–º–≤–æ–ª—ñ—á–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ –¥–æ–¥–∞—Ç–∫—É
‚îú‚îÄ‚îÄ venv/                  # Python –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
‚îú‚îÄ‚îÄ certbot-renew.sh       # –°–∫—Ä–∏–ø—Ç –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
‚îî‚îÄ‚îÄ .env                   # –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

/etc/letsencrypt/
‚îú‚îÄ‚îÄ live/
‚îÇ   ‚îî‚îÄ‚îÄ –≤–∞—à-–¥–æ–º–µ–Ω.duckdns.org/
‚îÇ       ‚îú‚îÄ‚îÄ fullchain.pem
‚îÇ       ‚îî‚îÄ‚îÄ privkey.pem
‚îî‚îÄ‚îÄ duckdns.ini            # Credentials –¥–ª—è DuckDNS
```

---

## üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É

```bash
cd /opt/print-server
sudo -u printserver git pull

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (—è–∫—â–æ –∑–º—ñ–Ω–∏–ª–∏—Å—è)
sudo -u printserver ./venv/bin/pip install -r requirements-native.txt

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É
sudo systemctl restart print-server.service
```

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- **–ü–æ—Ä—Ç forwarding –ù–ï –ø–æ—Ç—Ä—ñ–±–µ–Ω** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è DNS challenge —á–µ—Ä–µ–∑ DuckDNS API
- –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ cron (–∫–æ–∂–Ω—ñ 12 –≥–æ–¥–∏–Ω –∞–±–æ —â–æ–¥–Ω—è)
- –í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `/opt/print-server/config/`
- –°–µ—Ä–≤—ñ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–∏—Å—Ç–µ–º–∏
- –õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ systemd journal —Ç–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç—ñ —á–µ—Ä–µ–∑ `journalctl`

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ Docker –≤–µ—Ä—Å—ñ—î—é

| –ê—Å–ø–µ–∫—Ç | Docker –≤–µ—Ä—Å—ñ—è | –ù–∞—Ç–∏–≤–Ω–∞ Linux –≤–µ—Ä—Å—ñ—è |
|--------|---------------|----------------------|
| **–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è** | ‚≠ê‚≠ê –ü—Ä–æ—Å—Ç—ñ—à–µ | ‚≠ê‚≠ê‚≠ê –°–∫–ª–∞–¥–Ω—ñ—à–µ |
| **–Ü–∑–æ–ª—è—Ü—ñ—è** | ‚úÖ –ü–æ–≤–Ω–∞ | ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å–∏—Å—Ç–µ–º–∏ |
| **–ü–µ—Ä–µ–Ω–æ—Å–∏–º—ñ—Å—Ç—å** | ‚úÖ –í–∏—Å–æ–∫–∞ | ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –û–° |
| **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê –î–æ–±—Ä–µ | ‚≠ê‚≠ê‚≠ê‚≠ê –ö—Ä–∞—â–µ |
| **–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ | ‚ö†Ô∏è –í—Ä—É—á–Ω—É |
| **–û–Ω–æ–≤–ª–µ–Ω–Ω—è** | ‚úÖ –ü—Ä–æ—Å—Ç—ñ—à–µ | ‚ö†Ô∏è –°–∫–ª–∞–¥–Ω—ñ—à–µ |
| **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è** | –î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | –î–ª—è –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ |

---

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—Ä–æ–±–ª–µ–º —Å—Ç–≤–æ—Ä—é–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É.

---

## –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT License

